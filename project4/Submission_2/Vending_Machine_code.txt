state my_base_class {

var int total = 0;
var bool ready = true;

  method isReady()
  {
    ready;
  }

}

state idle case of my_base_class {

  method deposit_coin(amount) [idle >> coin_deposit]
  {
      ready = false;
      this <- coin_deposit{ var int amount_deposited = amount; };
  }

  method request_soda(price) [idle >> soda_eval]
  {

  ready = false;
    this <- soda_eval{var int price_of_request = price;}   

  }

  method check_amount()
  {
    total;
  }

}

state coin_deposit case of my_base_class {

var int amount_deposited;

  method execute() [coin_deposit >> idle]
  {
    add_amount();
    ready = true;
  }

  method add_amount() [coin_deposit >> idle]
  {
    total = total + amount_deposited;
    this <- idle{};
  }

}

state soda_eval case of my_base_class {

var int price_of_request;

  method execute()
  {
    evaluate();
  }

  method evaluate()
  {
    
    ifElse ( price_of_request > total )

    { this <- insufficient_fund {} }

    {this <- vending{var int price_of_request = price_of_request;} };

}

}

state insufficient_fund case of my_base_class {

method execute()[insufficient_fund >> idle]
{
  ready = true;
  result();
}

method result() [insufficient_fund >> idle]

{

    java.lang.System.out.println("Not enough money");

    this <- idle{};

}

}

state vending case of my_base_class {

var int price_of_request;

method execute() [vending >> idle]
{
  ready = true;
  result();
}

method result() [vending >> idle]

{

 java.lang.System.out.println("Enjoy your soda");

 total = total - price_of_request;

 this <- idle{};

}

}

method main()
{

  var focus = new my_base_class;
  val print = java.lang.System.out.println;

  focus <- idle{};

  print("Depositing 50 cents");
  focus.deposit_coin(50);

  while {!focus.isReady();}
  {focus.execute();};

  print("Vending machine currently has " + focus.check_amount() + " cents available");

  print("Requesting a soda that costs 75 cents");
  focus.request_soda(75);

  while {!focus.isReady();}
  {focus.execute();};

  print("Depositing another 50 cents");
  focus.deposit_coin(50);

  while {!focus.isReady();}
  {focus.execute();};

  print("Machine now has " + focus.check_amount() + " cents available");

  print("Requesting a soda that costs 75 cents");
  focus.request_soda(75);

  while {!focus.isReady();}
  {focus.execute();};

}
